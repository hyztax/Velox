<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="icon" href="velox.image/Velox_logo.png">
  <title>Velox</title>
  <link rel="stylesheet" href="main.css" />
  <!-- <script src="notifications.js"></script> -->

  <style>

    #starfield {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
    }
</style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>

<header>
  <div class="user-info">
    <span id="greeting"></span><span id="usernameDisplay"></span>
  </div>

  <button id="settingsBtn" aria-label="Menu" aria-expanded="false" aria-controls="settingsMenu">
    <span></span>
    <span></span>
    <span></span>
  </button>

  <div id="settingsMenu" class="hidden" role="menu" aria-hidden="true">
    <button id="showProfileBtn" role="menuitem">Edit Profile</button>
    <button id="faqBtn" role="menuitem" onclick="window.location.href='faq.html'">FAQ</button>
    <button id="logoutBtn" role="menuitem">Log Out</button>
  </div>
</header>

<style>
  header {
    display: flex;
    align-items: center;       /* vertically centered */
    justify-content: center;   /* horizontally centered */
    gap: 15px;                 /* space between username and menu button */
    padding: 8px 12px;
  }

  .user-info {
    display: flex;
    align-items: center;
  }

  #greeting {
    margin-right: 3px; /* tiny space before username */
  }

  #settingsBtn {
    cursor: pointer;
  }
</style>


 <div class="spotify-container">
  <iframe 
    src="https://open.spotify.com/embed/playlist/7p9ALjNzssa5ePbcIaWGH2?utm_source=generator&theme=0" 
    frameborder="0" 
    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
    allowfullscreen>
  </iframe>
</div> 








<script>
  function getGreeting() {
    const now = new Date();
    const hour = now.getHours();

    if (hour >= 5 && hour < 12) {
      return "Good morning";
    } else if (hour >= 12 && hour < 17) {
      return "Good afternoon";
    } else if (hour >= 17 && hour < 21) {
      return "Good evening";
    } else {
      return "Good night";
    }
  }

  document.getElementById("greeting").textContent = getGreeting();
  document.getElementById("usernameDisplay").textContent = "";
</script>



<!-- <div id="notificationContainer"></div> -->

<!-- Welcome Title -->
<div class="welcome-title" role="banner" aria-label="Welcome Title">
  <h1>WELCOME TO <span class="velox-green">VELOX</span></h1>
</div>

<!-- Users Online List -->
<div id="usersList" aria-label="List of users online">
  <h2>USERS ONLINE</h2>
  <input type="text" id="searchInput" placeholder="Search for an online user" autocomplete="off" />
  <ul id="usersUl"></ul>
</div>

<!-- View Profile Modal -->
<div id="profileModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="profileName" aria-describedby="profileBio">
  <div class="modal-content">
    <div class="profile-avatar" id="profileAvatar">AB</div>
    <h3 id="profileName">Name</h3>
    <div class="profile-tag" id="profileTag">#1234</div>
    <p id="profileBio">Bio goes here...</p>

    <div id="profileActions" style="display: flex; gap: 10px; margin-top: 10px;">
      <!-- JS will inject buttons here dynamically -->
    </div>
    

    <button id="profileCloseBtn" aria-label="Close profile view">Close</button>
    
    <p id="mutualFriendsCount" style="color: rgb(218, 206, 149); margin-top:10px;">Mutual friends: 0</p>
  </div>
</div>

<!-- Edit Profile Modal --> 
<div id="profileEditor" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="editProfileTitle">
  <div class="modal-content">
    <h3 id="editProfileTitle">Edit Your Profile</h3>
    <input id="editorName" type="text" placeholder="Display name" autocomplete="off" />
    <textarea id="editorBio" placeholder="Bio"></textarea>

    <label for="avatarColorPicker">Choose avatar color:</label>
    <input id="avatarColorPicker" type="color" value="#00ff00" />

    
   
    <button id="saveProfileBtn">Save</button>
    <button id="editorCloseBtn">Cancel</button>
  </div>
</div>

<!-- Messaging Modal -->
<div id="messageModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="messageTitle">
  <div class="modal-content">
    <h3 id="messageTitle">Message <span id="messageToUsername"></span></h3>
    <div id="messageHistory" class="message-history"></div>
    <textarea id="messageInput" placeholder="Type your message..."></textarea>
    <button id="sendMsgBtn">Send</button>
    <button id="messageCloseBtn">Close</button>
  </div>
</div>

<!-- Invite Button at Bottom -->
<div style="text-align:center; margin-top: 30px;">
  <button id="inviteBtn">Invite Your Friends</button>
</div>

<!-- ====== New Friend System UI Sections ====== -->

<div class="container" style="margin-top: 40px; max-width: 1100px; margin-left: auto; margin-right: auto; gap: 20px; display: flex; flex-wrap: wrap;">

  <!-- Friends List -->
  <section aria-label="Your Friends" style="flex: 1; min-width: 100px;">
    <h2>FRIENDS</h2>
    <input type="text" id="searchFriends" placeholder="Search for a friend" autocomplete="off" />
    <ul id="friendsList"></ul>
  </section>

  <script>
document.addEventListener("DOMContentLoaded", () => {
  const searchInput = document.getElementById("searchFriends");
  const friendsList = document.getElementById("friendsList");

  // If elements aren't found, just skip
  if (!searchInput || !friendsList) return;

  searchInput.addEventListener("input", function() {
    const query = this.value.toLowerCase();

    // Always get the latest <li> elements
    const friends = Array.from(friendsList.getElementsByTagName("li"));

    friends.forEach(friend => {
      const name = friend.textContent.toLowerCase();
      friend.style.display = name.includes(query) ? "" : "none";
    });
  });
});
</script>




  <!-- ska fixa senare (kanske) -->
<!-- <div id="allUsersList" aria-label="List of all users with accounts" style="margin-top: 40px;">
  <h2>ALL USERS</h2>
  <input type="text" id="searchAllUsers" placeholder="Search for user..." autocomplete="off" />
  <ul id="allUsersUl"></ul>
</div> -->





  <!-- Incoming Friend Requests -->
  <section aria-label="Friend Requests" style="flex: 1; min-width: 100px; color: rgb(178, 179, 180);">
    <h2>REQUESTS</h2>
    <input type="text" id="searchRequests" placeholder="Search for a request" autocomplete="off" />
    <ul id="friendRequestsList"></ul>
  </section>

  <script>
document.addEventListener("DOMContentLoaded", () => {
  const searchRequestsInput = document.getElementById("searchRequests");
  const friendRequestsList = document.getElementById("friendRequestsList");

  // Make sure elements exist
  if (!searchRequestsInput || !friendRequestsList) return;

  searchRequestsInput.addEventListener("input", function() {
    const query = this.value.toLowerCase();

    // Grab current <li> items dynamically
    const requests = Array.from(friendRequestsList.getElementsByTagName("li"));

    requests.forEach(request => {
      const name = request.textContent.toLowerCase();
      request.style.display = name.includes(query) ? "" : "none";
    });
  });
});
</script>


  <a href="chat.html" class="Velox_Shop" rel="noopener noreferrer">
    <img src="velox.image/icon.png" alt="Shop Image" />
    <span>Enter Chat</span>
  </a>
  

<!-- <a href="#" class="Velox_Connect" onclick="claimAndRedirect(event)">
  <span class="shine">Claim [tester]</span>
</a>  fixar denna senare -->

<script>
function claimAndRedirect(event) {
  event.preventDefault();

  // Simply redirect to the login page in the same tab
  window.location.href = 'https://login-phi-rose.vercel.app/';
}
</script>




</div>

<canvas id="starfield"></canvas>

<!-- Update Button -->
<div id="updateContainer">
  <button id="updateBtn">Check for Updates</button>
</div>

<!-- Update Button Container -->
<div id="updateContainer" style="display:none;">
  <button id="updateBtn">Check for Updates</button>
</div>

<style>
  #updateContainer {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 99999;
    display: flex;
  }

  #updateBtn {
    background: linear-gradient(135deg, #1f0d3350, #3f547970);
    color: white;
    font-size: 16px;
    font-weight: bold;
    padding: 12px 24px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    transition: transform 0.6s ease, box-shadow 0.8s ease, background 0.6s ease;
    min-width: 160px;
    min-height: 45px;
  }

  #updateBtn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(5, 5, 5, 0.671);
    background: linear-gradient(135deg, #0c1f3f70, #390c6d50);
  }

  #updateBtn:active {
    transform: translateY(0);
    box-shadow: 0 4px 10px rgba(238, 238, 238, 0.548);
  }
</style>

<script>
const btn = document.getElementById('updateBtn');
const isElectron = typeof window !== 'undefined' && window.electronAPI;

if (isElectron) {
  btn.style.display = 'block';

  btn.addEventListener('click', () => {
    btn.innerText = "Checking...";
    btn.disabled = true;
    window.electronAPI.checkForUpdates();
  });

  window.electronAPI.onUpdateAvailable(() => {
    btn.innerText = "Downloading...";
  });

  window.electronAPI.onUpdateDownloaded(() => {
    btn.innerText = "Update Ready!";
    setTimeout(() => {
      btn.innerText = "Check for Updates";
      btn.disabled = false;
    }, 3000);
  });
} else {
  btn.style.display = 'none';
}

</script>


<!-- POPUP -->
<div class="GAME" id="popup">
  <div class="popup-content">
    <span class="close-btn">&times;</span>
    <h2>Try Vopper now ! 🎮</h2>
    <p>Check out my new game! 🚀 Give it a try and see how far you can get!</p>
    
    <a href="vopper.html" class="popup-btn">Play Now</a>
  </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", () => {
  const popup = document.getElementById("popup");
  const closeBtn = document.querySelector(".close-btn");

  // Detect if the device is a laptop/PC
  const isDesktop = () => {
    const ua = navigator.userAgent;
    const isMobile = /Mobi|Android|iPhone|iPad|iPod|Tablet/i.test(ua);
    return !isMobile;
  }

  if (isDesktop()) {
    // Show popup on desktop only
    popup.style.display = "flex";

    // Close on click
    closeBtn.addEventListener("click", () => {
      popup.style.display = "none";
    });
  } else {
    // Hide popup on mobile/tablet
    popup.style.display = "none";
  }
});
</script>




<script src="main.js"></script>
<script src="stars.js"></script>
</body>
</html>
