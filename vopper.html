<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="velox.image/Velox_logo.png">
  <title>Velox | vopper</title>
  <link rel="stylesheet" href="vopper.css">
  <script src="stars.js" defer></script>
  <link rel="stylesheet" href="global.css" />
  
  <style>
    #starfield {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    #myCanvas {
      display: block;
      margin: auto;
      background: #0f0e0e00;
      position: relative;
      z-index: 1;
    }
  </style>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  
  const firebaseConfig = {
    apiKey: "AIzaSyBXb9OhOEOo4gXNIv2WcCNmXfnm1x7R2EM",
    authDomain: "velox-c39ad.firebaseapp.com",
    projectId: "velox-c39ad",
    storageBucket: "velox-c39ad.appspot.com",
    messagingSenderId: "404832661601",
    appId: "1:404832661601:web:9ad221c8bfb459410bba20",
    measurementId: "G-X8W755KRF6"
  };

  
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  
  window.firebaseApp = app;
  window.firebaseAuth = auth;
  window.firebaseDB = db;


  import "./vopper.js";
  import "./score.js";
</script>

</head>

<body>
  <div id="messagesContainer"></div>

  <canvas id="starfield"></canvas>
  <canvas id="myCanvas" width="400" height="900"></canvas>

<div class="controls-box">
  <h2>Game Controls</h2>
  <h3>click to change keybind!</h3>
  <div class="controls">
    <div class="key" data-action="left">
      <h1>A</h1>
      <p>Left</p>
    </div>
    <div class="key" data-action="right">
      <h1>D</h1>
      <p>Right</p>
    </div>
    <div class="key" data-action="jump">
      <h1>SPACE</h1>
      <p>Jump / double jump</p>
    </div>
  </div>

  
 <a href="vopperCUS.html" class="change">Customize Ball</a>

</div>

  <script>
  
    const keyMap = {
      left: "a",
      right: "d",
      jump: " "
    };

  
    const savedKeys = localStorage.getItem("vopperKeys");
    if (savedKeys) Object.assign(keyMap, JSON.parse(savedKeys));

    const keys = {}; 

    
    function updateControlUI() {
      document.querySelectorAll(".key").forEach(keyDiv => {
        const action = keyDiv.dataset.action;
        let displayKey = keyMap[action].toUpperCase();
        if (displayKey === " ") displayKey = "SPACE";
        keyDiv.querySelector("h1").textContent = displayKey;
      });
    }

    
    updateControlUI();

 
    document.querySelectorAll(".key").forEach(keyDiv => {
      keyDiv.addEventListener("click", () => {
        const action = keyDiv.dataset.action;
        keyDiv.querySelector("h1").textContent = "Press...";

        const handler = (e) => {
          e.preventDefault();
          let newKey = e.key;
          keyMap[action] = newKey.toLowerCase();

          // Update display
          let displayKey = newKey.toUpperCase();
          if (displayKey === " ") displayKey = "SPACE";
          keyDiv.querySelector("h1").textContent = displayKey;

          
          localStorage.setItem("vopperKeys", JSON.stringify(keyMap));

          window.removeEventListener("keydown", handler);
        };

        window.addEventListener("keydown", handler);
      });
    });

    
    window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
    window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

    
    function update(delta) {
      if (keys[keyMap.left]) player.x -= moveSpeed * delta;
      if (keys[keyMap.right]) player.x += moveSpeed * delta;

      if (keys[keyMap.jump] && player.jumpCount < player.maxJumps) {
        player.vy = -player.jumpPower;
        player.jumpCount++;
        keys[keyMap.jump] = false;
      
      }

      
    }
  </script>


  <div class="GoBack" onclick="window.location='main.html';"></div>


  
          <div id="leaderboard" style="
        position: fixed;        /* stay in place */
        top: 50px;              /* distance from top */
        right: 20px;            /* distance from right */
        width: 250px;
        max-height: 90%;        /* allow scrolling if too tall */
        overflow-y: auto;
        background: rgba(35, 4, 44, 0.233);
        border-radius: 12px;
        color: white;
        padding: 15px;
        font-family: 'Poppins', sans-serif;
        font-size: 16px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.5);
        z-index: 9999;          /* stay above other elements */
        ">
            <h3 style="text-align:center; margin-bottom:12px; font-size:20px;">üèÜ Top Players</h3>
            <div id="scores-list" style="display:flex; flex-direction:column; gap:8px;">
              Loading...
            </div>
          </div>

         
          <script type="module" src="global.js"></script>
</body>

</html>