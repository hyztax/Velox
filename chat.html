<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="velox.image/Velox_logo.png">
  <title>Velox | Chat</title>
  <link rel="stylesheet" href="chat.css" />
  
  <!-- <link rel="stylesheet" href="global.css" /> -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <!-- <script src="notifcations.js"></script> -->
  

  <style>
    #starfield { position: fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
  </style>
  
</head>
<body>
  <div id="messagesContainer"></div>

<!-- 
  <div id="notificationContainer"></div> -->

  <div id="app">
   <!-- Friends List Section -->
<section id="friendsSection">
  <h2 style="color: white;">
    Friends | <a href="main.html" style="color:white; text-decoration: underline;">Go back</a>
  </h2>

  <!-- Search + Create Group Button Container -->
  <div style="display: flex; align-items: stretch; gap: 5px; margin-bottom: 10px;">
    <input id="searchFriends" placeholder="Search friends..." style="flex: 1; padding: 5px;" />
    <button id="createGroupBtn" title="Create Group" 
        style="padding: 0 10px; cursor: pointer; height: 100%; 
               background: none; border: none; color: white; font-size: 1.1em;">
        ðŸ‘¥
    </button>
  </div>

  <div id="friendsList"></div>
</section>

<!-- Group Chat Modal -->
<div id="groupModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
     background: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000;">
  <div style="background:#222; padding:20px; border-radius:8px; max-width:400px; width:90%;">
    <h3 style="color:white;">Create Group Chat</h3>
    <input id="groupNameInput" placeholder="Group name" style="width:100%; margin-bottom:10px; padding:5px;" />
    <div id="groupFriendsList" style="max-height:200px; overflow-y:auto; margin-bottom:10px;"></div>
    <button id="createGroupConfirmBtn" style="padding:5px 10px; cursor:pointer;">Create Group</button>
    <button id="createGroupCancelBtn" style="padding:5px 10px; cursor:pointer; margin-left:5px;">Cancel</button>
  </div>
</div>

<div id="contextMenu" style="
    position: absolute; display: none; background: #222; color: white; 
    padding: 5px; border-radius: 5px; z-index: 10000; min-width: 120px;
"></div>

<div class="FriendActivity">
  <h3>Friend Status</h3>
  <div id="activityList"></div>

  <script>firebase.auth().onAuthStateChanged((currentUser) => {
    if (!currentUser) return console.log("Not signed in yet.");
  
    console.log("Signed in as:", currentUser.uid);
  
    const activityList = document.getElementById('activityList');
    const friendsRef = db.collection('friends').doc(currentUser.uid).collection('list');
    const profilesRef = db.collection('profiles');
  
    friendsRef.onSnapshot(async (snapshot) => {
      if (!activityList) return;
  
      const onlineFriends = [];
  
      for (const doc of snapshot.docs) {
        const uid = doc.id;
        const online = doc.data().online || false;
  
        if (online) {
          const profileSnap = await profilesRef.doc(uid).get();
          const profile = profileSnap.exists ? profileSnap.data() : {};
          onlineFriends.push({ uid, displayName: profile.displayName || "Unknown" });
        }
      }
  
      activityList.innerHTML = '';
      if (onlineFriends.length === 0) {
        activityList.innerHTML = '<p>No friends online.</p>';
        return;
      }
  
      onlineFriends.forEach(f => {
        const div = document.createElement('div');
        div.textContent = f.displayName + ' â€¢ Online';
        activityList.appendChild(div);
      });
    });
  });
  
  </script>  
</div>



    <!-- Profile Section -->
    <section id="profileSection">
      <div id="profileAvatar" class="profile-avatar"></div>
      <h3 id="profileName" class="profile-name"></h3>
      <p id="profileBio" class="profile-bio"></p>
      <div>
        <button id="backToFriendsBtn" type="button">Back to Friends</button>
        <button id="messageUserBtn" type="button">Message User</button>
      </div>
    </section>

<!-- Add this somewhere in main.html -->
<div id="reportModal" class="modal" style="display:none;">
  <div class="modal-content">
    <h3 style="margin: 0; padding: 0; line-height: 1;">Report Message</h3>
    <h4 style="margin: 0; padding: 0; line-height: 1; font-weight: 300;">[any false reports can / will result in a account ban]</h4>
    <textarea id="reportReason" placeholder="Describe the issue..."></textarea>
    <button id="submitReport">Submit</button>
    <button id="cancelReport">Cancel</button>
  </div>
</div>



   <!-- Chat Section -->
    <section id="chatSection">

  <header id="chatHeader"></header>

  <div id="chatMessages"></div>

  <!-- Group members sidebar (hidden by default) -->
  <div id="groupSidebar" style="display: none;">
    <h3>Member List</h3>
<div class="underline"></div>    
    <ul id="groupMembersList"></ul>
    <div id="addMemberSection">
      <input type="text" id="addMemberSearch" placeholder="Enter Username..." />
      <button id="addMemberBtn">Add</button>
    </div>
  </div>

  <form id="chatInputArea" onsubmit="return false" style="display: flex; flex-direction: column;">
    <div style="display: flex; align-items: flex-end;">
      <textarea 
        id="messageInput" 
        placeholder="Enter message.." 
        rows="1" 
        style="flex: 1; resize: none; overflow-y: hidden; max-height: 90px;">
      </textarea>

      <button id="sendBtn" type="submit" disabled style="margin-left: 10px;">â†‘</button>
    </div>
    <div id="charCounter" style="align-self: flex-end; font-size: 0.8em; color: #aaa;">0 / 300</div>
  </form>
</section>
  </div>



  <script type="module" src="global.js"></script>
  <canvas id="starfield"></canvas>
  <script src="stars.js"></script>
  <script src="chat.js"></script>
</body>
</html>
